import{_ as o,r,o as p,c as B,b as a,e as i,w as l,a as t,d as e}from"./app-CBhv_KBJ.js";const c={},d={class:"table-of-contents"};function k(h,s){const n=r("router-link");return p(),B("div",null,[a("nav",d,[a("ul",null,[a("li",null,[i(n,{to:"#_1-å®šä½é—®é¢˜"},{default:l(()=>s[0]||(s[0]=[e("1. å®šä½é—®é¢˜")])),_:1}),a("ul",null,[a("li",null,[i(n,{to:"#_1-1-å…³é”®"},{default:l(()=>s[1]||(s[1]=[e("1.1. å…³é”®")])),_:1})]),a("li",null,[i(n,{to:"#_1-2-æºç "},{default:l(()=>s[2]||(s[2]=[e("1.2. æºç ")])),_:1})])])]),a("li",null,[i(n,{to:"#_2-è°ƒè¯•"},{default:l(()=>s[3]||(s[3]=[e("2. è°ƒè¯•")])),_:1}),a("ul",null,[a("li",null,[i(n,{to:"#_2-1-å‡†å¤‡å·¥ä½œ"},{default:l(()=>s[4]||(s[4]=[e("2.1. å‡†å¤‡å·¥ä½œ")])),_:1})]),a("li",null,[i(n,{to:"#_2-2-å…³é”®å‡½æ•°-commentbox-vueçš„submitcommentå’Œwatch"},{default:l(()=>s[5]||(s[5]=[e("2.2. å…³é”®å‡½æ•° CommentBox.vueçš„submitCommentå’Œwatch")])),_:1})]),a("li",null,[i(n,{to:"#_2-3-æ–­ç‚¹æµ‹è¯•-æ•´ä½“æµç¨‹å¦‚ä¸‹"},{default:l(()=>s[6]||(s[6]=[e("2.3. æ–­ç‚¹æµ‹è¯•ï¼Œæ•´ä½“æµç¨‹å¦‚ä¸‹")])),_:1})]),a("li",null,[i(n,{to:"#_2-4-åˆ†æ"},{default:l(()=>s[7]||(s[7]=[e("2.4. åˆ†æ")])),_:1})])])]),a("li",null,[i(n,{to:"#_3-éªŒè¯"},{default:l(()=>s[8]||(s[8]=[e("3. éªŒè¯")])),_:1}),a("ul",null,[a("li",null,[i(n,{to:"#_3-1-è‡³æ­¤é—®é¢˜è§£å†³"},{default:l(()=>s[9]||(s[9]=[e("3.1. è‡³æ­¤é—®é¢˜è§£å†³")])),_:1})])])]),a("li",null,[i(n,{to:"#_4-æ€è€ƒ"},{default:l(()=>s[10]||(s[10]=[e("4. æ€è€ƒ")])),_:1})])])]),s[11]||(s[11]=t(`<div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>å‰è¨€ï¼š Waline è¯„è®ºç³»ç»Ÿè¿™ä¸ª bug æœ‰å‡ ä¸ªæœˆäº†ï¼Œç°è±¡å°±æ˜¯å›å¤å®Œå…¶ä»–äººçš„è¯„è®ºåï¼Œè¯„è®ºå†…å®¹ä¼šä¿ç•™åœ¨é¡¶éƒ¨è¾“å…¥æ¡†ä¸­ï¼Œè€Œä¸”ä¸ä¼šè‡ªåŠ¨æ¸…ç©ºã€‚å…·ä½“è§ ğŸ‘‰<a href="https://github.com/walinejs/waline/issues/2371" target="_blank" rel="noopener noreferrer">GitHub issuse #2173</a></p><p>è®¸ä¹…æœªè§ä¿®å¤ï¼Œæ­£å¥½æˆ‘æœ‰ç©ºï¼Œå°±çœ‹çœ‹è¿™ä¸ªé—®é¢˜ï¼Œæ¥ä¸‹æ¥è·Ÿæˆ‘ä¸€èµ·åˆ†æä¸€ä¸‹è¿™ä¸ªé—®é¢˜</p></div><h2 id="_1-å®šä½é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_1-å®šä½é—®é¢˜"><span>1. å®šä½é—®é¢˜</span></a></h2><p>é—®é¢˜ç°è±¡ä¸Šè¾¹å·²ç»æè¿°è¿‡äº†ï¼Œæˆ‘ä»¬å…ˆæ¥å®šä½ä¸€ä¸‹é—®é¢˜ã€‚</p><h3 id="_1-1-å…³é”®" tabindex="-1"><a class="header-anchor" href="#_1-1-å…³é”®"><span>1.1. å…³é”®</span></a></h3><p>å…³é”®åœ¨äºã€ä¸ä¼šæ¸…ç©ºã€‘ï¼Œå³ä½¿åˆ·æ–°æµè§ˆå™¨ï¼Œä¹Ÿä¸ä¼šæ¸…ç©ºï¼Œç”±æ­¤å¯çŸ¥å¿…ç„¶ä¿å­˜åœ¨ localStorage ä¸­ï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œçœ‹çœ‹ä¿å­˜åœ¨ localStorage ä¸­çš„æ•°æ®ç»“æ„ã€‚å‘ç°å¦‚ä¸‹å›¾æ‰€ç¤º</p><figure><img src="https://s3.bmp.ovh/imgs/2024/05/23/54fa93eb4563daea.png" alt="localStorage" tabindex="0" loading="lazy"><figcaption>localStorage</figcaption></figure><p>ç„¶åæœ‰äº†<strong>key</strong>å°±å¥½åŠäº†</p><h3 id="_1-2-æºç " tabindex="-1"><a class="header-anchor" href="#_1-2-æºç "><span>1.2. æºç </span></a></h3><p>åœ¨ Waline è¯„è®ºç³»ç»Ÿæºç ä¸­ï¼Œæˆ‘ä»¬å…¨å±€æœç´¢ <code>WALINE_COMMENT_BOX_EDITOR</code> ç»“æœå¦‚ä¸‹</p><div class="language-ts line-numbers-mode" data-ext="ts" data-title="ts"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// walinejs/packages/client/src/composables/inputs.ts</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="color:#E06C75;--shiki-dark:#E06C75;">RemovableRef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;@vueuse/core&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="color:#E06C75;--shiki-dark:#E06C75;">useStorage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;@vueuse/core&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">export</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> UserMeta</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    nick</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    mail</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    link</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">export</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> useUserMeta</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (): </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">RemovableRef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">UserMeta</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#C678DD;--shiki-dark:#C678DD;">=&gt;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">useStorage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">UserMeta</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;WALINE_USER_META&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    nick</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    mail</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    link</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#C678DD;--shiki-dark:#C678DD;">export</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> useEditor</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (): </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">RemovableRef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#C678DD;--shiki-dark:#C678DD;">=&gt;</span></span>
<span class="line highlighted"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">useStorage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;WALINE_COMMENT_BOX_EDITOR&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»§ç»­æŸ¥æ‰¾è°ƒç”¨ï¼Œæ‰¾åˆ°<code>CommentBox.vue</code>å…³é”®ç»„ä»¶ï¼Œè¯¥ç»„ä»¶å°†<em>textarea</em>è¯„è®ºæ¡†<strong>v-model</strong>ä¸<code>useEditor</code>å‡½æ•°ç»‘å®šï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ª<code>RemovableRef</code>ï¼Œè¯¥ç±»å‹ä¸º<code>&lt;string&gt;</code>ã€‚</p><div class="language-ts" data-ext="ts" data-title="ts"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">const</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> editor</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> useEditor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span></code></pre></div><div class="language-vue" data-ext="vue" data-title="vue"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">textarea</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">  id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;wl-edit&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">  ref</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;editorRef&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">  v-model</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">editor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">  class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;wl-editor&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  :</span><span style="color:#D19A66;--shiki-dark:#D19A66;">placeholder</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">replyUser</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ?</span><span style="color:#98C379;--shiki-dark:#98C379;"> \`@</span><span style="color:#C678DD;--shiki-dark:#C678DD;">\${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">replyUser</span><span style="color:#C678DD;--shiki-dark:#C678DD;">}</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> :</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> locale</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">placeholder</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  @</span><span style="color:#D19A66;--shiki-dark:#D19A66;">keydown</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">onKeyDown</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  @</span><span style="color:#D19A66;--shiki-dark:#D19A66;">drop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">onDrop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  @</span><span style="color:#D19A66;--shiki-dark:#D19A66;">paste</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">onPaste</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span></code></pre></div><h2 id="_2-è°ƒè¯•" tabindex="-1"><a class="header-anchor" href="#_2-è°ƒè¯•"><span>2. è°ƒè¯•</span></a></h2><h3 id="_2-1-å‡†å¤‡å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#_2-1-å‡†å¤‡å·¥ä½œ"><span>2.1. å‡†å¤‡å·¥ä½œ</span></a></h3><ol><li><p>å·²é”å®šé—®é¢˜æ–‡ä»¶ä¸º<code>CommentBox.vue</code>,æ¥ä¸‹æ¥å¼€å§‹ debugï¼Œå› ä¸ºå‡†å¤‡æ PRï¼Œæ‰€ä»¥å…ˆ fork ä¸€ä»½</p></li><li><p>æŒ‰ç…§<a href="https://waline.js.org/advanced/contribution.html" target="_blank" rel="noopener noreferrer">waline-è´¡çŒ®æŒ‡å—</a>è¿›è¡Œå‡†å¤‡</p></li><li><p>å…ˆæ‰§è¡Œ<code>pnpm i &amp; pnpm build</code>,æœ¬åœ°è°ƒè¯•ä¾èµ–<code>@waline/api</code> éœ€è¦å‰ç½® build</p></li><li><p>ä½¿ç”¨ <code>pnpm client:dev</code> å¯åŠ¨ <code>@waline/client</code> æœ¬åœ°å¼€å‘,ç”±äº waline æ˜¯ Client/Server æ¶æ„ï¼Œåœ¨è°ƒè¯• client æ—¶ï¼Œä½ éœ€è¦è®¾ç½® SERVERURL ä¸ºè°ƒè¯•æœåŠ¡å™¨ï¼ˆå¯ä»¥ç›´æ¥ä½¿ç”¨ vercel çš„æœåŠ¡å™¨ï¼‰ï¼Œæˆ–åŒæ—¶å¯åŠ¨ä¸‹é¢çš„ server å¼€å‘æœåŠ¡å™¨å¹¶ä½¿ç”¨é»˜è®¤çš„ <code>localhost:9090</code>ã€‚</p></li><li><p>ä½¿ç”¨ <code>pnpm server:dev</code> å¯åŠ¨ <code>@waline/server</code> æœ¬åœ°å¼€å‘,é…ç½®å¿…è¦çš„æœ¬åœ°ç¯å¢ƒå˜é‡è‡³ <code>example/.env</code>ã€‚ï¼ˆè¿™é‡Œæˆ‘é…ç½®äº† <code>leancloud</code> çš„ç¯å¢ƒå˜é‡ï¼Œä¸€ç›´åœ¨æŠ¥é”™ï¼‰</p></li></ol><h3 id="_2-2-å…³é”®å‡½æ•°-commentbox-vueçš„submitcommentå’Œwatch" tabindex="-1"><a class="header-anchor" href="#_2-2-å…³é”®å‡½æ•°-commentbox-vueçš„submitcommentå’Œwatch"><span>2.2. å…³é”®å‡½æ•° <code>CommentBox.vue</code>çš„<code>submitComment</code>å’Œ<code>watch</code></span></a></h3><div class="language-ts line-numbers-mode" data-ext="ts" data-title="ts"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> submitComment</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (): </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Promise</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">void</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     // æ­¤å¤„...çœç•¥è‹¥å¹²</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">     try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E06C75;--shiki-dark:#E06C75;">recaptchaV3Key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">         comment</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">recaptchaV3</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">             await</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> useReCaptcha</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">recaptchaV3Key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">execute</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;social&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E06C75;--shiki-dark:#E06C75;">turnstileKey</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">         comment</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">turnstile</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> useTurnstile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">turnstileKey</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">execute</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;social&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         const</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> options</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">         serverURL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">         lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">         token</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">userInfo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">?.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">token</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">         comment</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         const</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> response</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">props</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">edit</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         ?</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> updateComment</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">             objectId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">props</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">edit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">objectId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             ...</span><span style="color:#E06C75;--shiki-dark:#E06C75;">options</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         })</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         :</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> addComment</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">options</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">         isSubmitting</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">response</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">errmsg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">return</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> alert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">response</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">errmsg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">         emit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;submit&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">response</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">data</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">         editor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">         previewText</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">props</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">replyId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">emit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;cancelReply&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">props</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">edit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">?.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">objectId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">emit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;cancelEdit&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">unknown</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">         isSubmitting</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">         alert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">((</span><span style="color:#E06C75;--shiki-dark:#E06C75;">err</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> TypeError</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="color:#E06C75;--shiki-dark:#E06C75;">message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> };</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥çœ‹ watch</p><div class="language-ts line-numbers-mode" data-ext="ts" data-title="ts"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">watch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  () </span><span style="color:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> editor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  (</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">highlighter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">texRenderer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> config</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    previewText</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> parseMarkdown</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      emojiMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">emoji</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      highlighter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      texRenderer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    wordNumber</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getWordNumber</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">autosize</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">editorRef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    else</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> autosize</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">destroy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">editorRef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  {</span></span>
<span class="line highlighted"><span style="color:#E06C75;--shiki-dark:#E06C75;">    immediate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-æ–­ç‚¹æµ‹è¯•-æ•´ä½“æµç¨‹å¦‚ä¸‹" tabindex="-1"><a class="header-anchor" href="#_2-3-æ–­ç‚¹æµ‹è¯•-æ•´ä½“æµç¨‹å¦‚ä¸‹"><span>2.3. æ–­ç‚¹æµ‹è¯•ï¼Œæ•´ä½“æµç¨‹å¦‚ä¸‹</span></a></h3><ol><li><p>ç›‘å¬<code>editor.value</code>ï¼Œå¹¶å°†<strong>editor</strong>å’Œ<strong>textarea</strong>ç»‘å®š,ç”¨æˆ·è¾“å…¥çš„å€¼è‡ªåŠ¨ä¿å­˜åœ¨<strong>localStorage</strong>ä¸­</p></li><li><p>ç‚¹å‡»æäº¤æŒ‰é’®ï¼Œå°†<strong>textarea</strong>ä¸­çš„å€¼å‘é€ç»™åç«¯ï¼Œæ”¶åˆ°å›è°ƒåå°†<strong>editor</strong>æ¸…ç©º,å¦‚æœæŠ›å‡ºå¼‚å¸¸åˆ™ä¸æ¸…ç©º</p></li><li><p>æ­£å¸¸æäº¤è¯„è®ºæ— å¼‚å¸¸ï¼Œåœ¨<code>submitComment</code>å‡½æ•°ä¸­çš„<code>editor.value = &#39;&#39;;</code>å°†<strong>localStorage</strong>å­˜å‚¨çš„å†…å®¹æ¸…ç©º</p></li><li><p>å›å¤ä»–äººè¯„è®ºæ—¶ï¼Œå‰ç½®æµç¨‹æäº¤å’Œæ­¥éª¤ 3 ä¸€è‡´ï¼Œç„¶åè§¦å‘äº†<code>watch</code>,æ­¤æ—¶<code>watch</code>ç›‘å¬åˆ°çš„<strong>value</strong>ä¸ºæœªè¢«æ¸…ç©ºçš„å€¼ï¼Œæ—¢ä¹‹å‰ç”¨æˆ·è¾“å…¥çš„å†…å®¹</p></li><li><p><code>submitComment</code>ä¸­çš„<code>editor.value = &#39;&#39;;</code>å’Œ<code>watch</code>éƒ½æ‰“ä¸Šäº†æ–­ç‚¹ï¼Œå…ˆèµ‹å€¼ä¸ºç©ºï¼Œåè§¦å‘<code>watch</code>ï¼Œè€Œæ­¤æ—¶<code>watch</code>çš„ value ä¸ºè¢«æ¸…ç©ºä¹‹å‰çš„å€¼ï¼Œå³ç”¨æˆ·è¾“å…¥çš„å†…å®¹</p></li></ol><h3 id="_2-4-åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_2-4-åˆ†æ"><span>2.4. åˆ†æ</span></a></h3><p>é—®é¢˜å·²ç»å®šä½åˆ°ä»£ç çº§åˆ«ï¼Œæ¥ä¸‹æ¥åªéœ€è¦æ‰¾åˆ° watch è¢«è§¦å‘çš„åŸå› å³å¯ï¼Œåˆæ­¥çŒœæµ‹å¯èƒ½åŸå› ï¼š</p><p><code>submitComment</code>æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œå…¶å†…éƒ¨èµ‹ç©ºå€¼åï¼Œ<code>editor.value=&#39;&#39;</code>æ²¡æœ‰åŠæ—¶æ›´æ–°ï¼Œå¯¼è‡´<code>watch</code>è§¦å‘å–åˆ°æ—§å€¼</p><p>é‚æ·»åŠ  watch çš„ bebug å‡½æ•°åŠ ä»¥éªŒè¯</p><ol><li><code>onTrack</code> å°†åœ¨å“åº”å±æ€§æˆ–å¼•ç”¨ä½œä¸ºä¾èµ–é¡¹è¢«è·Ÿè¸ªæ—¶è¢«è°ƒç”¨ã€‚ç›¸å½“äº get</li><li><code>onTrigger</code> å°†åœ¨ä¾¦å¬å™¨å›è°ƒè¢«ä¾èµ–é¡¹çš„å˜æ›´è§¦å‘æ—¶è¢«è°ƒç”¨ã€‚ç›¸å½“äº set</li></ol><div class="language-ts line-numbers-mode" data-ext="ts" data-title="ts"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">watch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  () </span><span style="color:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> editor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  (</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">highlighter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">texRenderer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> config</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    previewText</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> parseMarkdown</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      emojiMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">emoji</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      highlighter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      texRenderer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    wordNumber</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getWordNumber</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">autosize</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">editorRef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    else</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> autosize</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">destroy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">editorRef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    immediate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    onTrack</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">      // å½“ editor.value è¢«è¿½è¸ªä¸ºä¾èµ–æ—¶è§¦å‘</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">      debugger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    onTrigger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">      // å½“ editor.value è¢«æ›´æ”¹æ—¶è§¦å‘</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">      debugger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»“æœä¸ºï¼š</p><ol><li><code>editor.value=&#39;&#39;</code>æ—¶ï¼Œ<code>onTrigger</code>è§¦å‘ï¼ŒnewValue ä¸º<code>&#39;&#39;</code></li><li>ç´§æ¥ç€è§¦å‘<code>onTrack</code>value ä¸ºæ—§å€¼</li></ol><p>è°ƒæ•´å›è°ƒçš„è§¦å‘æ—¶æœºè¯•è¯•çœ‹ï¼š</p><ul><li><p><a href="https://cn.vuejs.org/guide/essentials/watchers.html#post-watchers" target="_blank" rel="noopener noreferrer">Post Watchers</a></p><p>å¦‚æœæƒ³åœ¨ä¾¦å¬å™¨å›è°ƒä¸­èƒ½è®¿é—®è¢« Vue æ›´æ–°<strong>ä¹‹å</strong>çš„æ‰€å±ç»„ä»¶çš„ DOMï¼Œä½ éœ€è¦æŒ‡æ˜ <code>flush: &#39;post&#39;</code> é€‰é¡¹ï¼š</p></li><li><p><a href="https://cn.vuejs.org/guide/essentials/watchers.html#sync-watchers" target="_blank" rel="noopener noreferrer">åŒæ­¥ä¾¦å¬å™¨</a></p><p>å®ƒä¼šåœ¨ Vue è¿›è¡Œä»»ä½•æ›´æ–°ä¹‹å‰è§¦å‘ï¼š</p><div class="hint-container warning"><p class="hint-container-title">æ³¨æ„</p><p>åŒæ­¥ä¾¦å¬å™¨ä¸ä¼šè¿›è¡Œæ‰¹å¤„ç†ï¼Œæ¯å½“æ£€æµ‹åˆ°å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶å°±ä¼šè§¦å‘ã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥ç›‘è§†ç®€å•çš„å¸ƒå°”å€¼ï¼Œä½†åº”é¿å…åœ¨å¯èƒ½å¤šæ¬¡åŒæ­¥ä¿®æ”¹çš„æ•°æ®æº (å¦‚æ•°ç»„) ä¸Šä½¿ç”¨ã€‚</p></div></li></ul><p>ç»“æœæ˜¯æ²¡æœ‰ä½œç”¨ï¼Œä½†åœ¨æ›´æ”¹ä¸º sync åï¼Œå‘ç°äº†ä¸€ä»¶æœ‰è¶£çš„äº‹æƒ…ï¼Œå› ä¸º sync ä¸ä¼šè¿›è¡Œæ‰¹å¤„ç†çš„ç‰¹æ€§ï¼Œæ‰€ä»¥è§¦å‘äº†ä¸¤æ¬¡<code>onTrack</code>,æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸¤æ¬¡çš„å †æ ˆä¿¡æ¯</p><figure><img src="https://s3.bmp.ovh/imgs/2024/05/23/f4ffa6bb556812cc.png" alt="ç¬¬ä¸€æ¬¡" tabindex="0" loading="lazy"><figcaption>ç¬¬ä¸€æ¬¡</figcaption></figure><figure><img src="https://s3.bmp.ovh/imgs/2024/05/23/33bc634ac459ec19.png" alt="ç¬¬äºŒæ¬¡" tabindex="0" loading="lazy"><figcaption>ç¬¬äºŒæ¬¡</figcaption></figure><p>å¾ˆæ˜æ˜¾ç¬¬ä¸€æ¬¡è§¦å‘æ˜¯<code>editor.value=&#39;&#39;</code>æ—¶è§¦å‘çš„ï¼Œç¬¬äºŒæ¬¡è§¦å‘å¼‚æ­¥çš„ï¼Œåœ¨<code>submitComment</code>è¿˜æœªæ‰§è¡Œå®Œæˆæ—¶å°±è§¦å‘äº†ï¼Œç‚¹å‡»å †æ ˆä¿¡æ¯å®šä½åˆ°äº†<strong>291</strong>è¡Œï¼Œå¾ˆæ˜æ˜¾æ—©äº<code>editor.value=&#39;&#39;</code>çš„<strong>297</strong>è¡Œã€‚æ‰€ä»¥å–åˆ°çš„æ˜¯æ—§çš„å€¼ï¼Œè™½ç„¶æ–­ç‚¹æ˜¯<code>editor.value=&#39;&#39;</code>å…ˆæ‰§è¡Œï¼Œä½†<code>submitComment</code>æ˜¯å¼‚æ­¥çš„ï¼Œwatch å–åˆ°çš„æ˜¯æ—§å€¼ï¼Œé‚£æ¥ä¸‹æ¥å°±éœ€è¦çœ‹ <mark><code>watch</code>æ˜¯è¢«ä»€ä¹ˆè§¦å‘äº†</mark></p><p>ç”±äºæºç ä¸­çš„<code>watch</code>æ˜¯å†™åœ¨<code>onMounted</code>ä¸­çš„ï¼Œæ–­ç‚¹ç¡®å®šäºŒæ¬¡èµ°åˆ°<code>watch</code>ä¸­æ—¶ï¼Œæ˜¯è§¦å‘äº†<code>onMounted</code>ï¼Œé‚£è§¦å‘<code>onMounted</code>æ˜¯ç»„ä»¶é‡æ–°åŠ è½½äº†ï¼ŒæŸ¥æ‰¾åå¾—çŸ¥ï¼Œæ•´ä½“é€»è¾‘æ˜¯ï¼Œè¯„è®ºåŒºåŸŸï¼Œä»£ç ç»“æ„å¦‚ä¸‹ï¼š</p><ul><li><p>ç»„ä»¶ä¸º<code>WalineComment.vue</code>,å…¶ä¸­åŒ…å«äº†è¯„è®ºåˆ—è¡¨ç»„ä»¶ item<code>CommentCard.vue</code>å’Œé¡¶éƒ¨é»˜è®¤è¾“å…¥æ¡†<code>CommentBox.vue</code></p></li><li><p>é’ˆå¯¹æ–‡ç« å‘å¸ƒè¯„è®ºä½¿ç”¨çš„æ˜¯é¡¶éƒ¨çš„<code>CommentBox.vue</code>ç»„ä»¶</p></li><li><p>é’ˆå¯¹è¯„è®ºå›å¤æ—¶ï¼Œä½¿ç”¨çš„æ˜¯<code>CommentCard.vue</code>-<code>CommentBox.vue</code></p></li><li><p>å›å¤å®Œæˆå<code>CommentCard.vue</code>-<code>CommentBox.vue</code>é”€æ¯ï¼Œé¡¶éƒ¨çš„<code>CommentBox.vue</code>ç»„ä»¶é‡æ–°æ¸²æŸ“</p></li></ul><p><mark>é¡¶éƒ¨çš„<code>CommentBox.vue</code>ç»„ä»¶é‡æ–°æ¸²æŸ“ä¼šè§¦å‘ watchï¼Œæ­¤æ—¶å–å€¼æ˜¯æ—§å€¼ï¼Œ</mark> ç»æŸ¥çœ‹ï¼Œ<code>submitComment</code>ä¸­çš„<code>editor.value=&#39;&#39;</code>æ‰§è¡Œå®Œåï¼Œ <code>localStorage</code> ä¸­çš„å€¼å¹¶æœªç«‹å³ä¿®æ”¹ï¼Œæ‰€ä»¥é‡æ–°æ¸²æŸ“çš„é¡¶éƒ¨<code>CommentBox.vue</code>ç»„ä»¶åœ¨åˆå§‹åŒ–æ—¶å–åˆ°çš„å€¼ä»ä¸º<code>localStorage</code>ä¸­çš„æ—§å€¼ã€‚</p><h2 id="_3-éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_3-éªŒè¯"><span>3. éªŒè¯</span></a></h2><p>ä¸Šè¾¹å·²ç»åŸºæœ¬ç¡®å®šé—®é¢˜å‡ºåœ¨è¿™å¥ä¸Š</p><div class="language-ts" data-ext="ts" data-title="ts"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">editor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><div class="language-ts" data-ext="ts" data-title="ts"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">const</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> editor</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> useEditor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span></code></pre></div><p>è€Œåœ¨ <a href="#_1-2-%E6%BA%90%E7%A0%81">1.2</a> ä¸­å¯ä»¥çœ‹åˆ°<code>useEditor()</code>æ˜¯<code>@vueuse/core</code>çš„å¯¼å‡ºå‡½æ•°,æ€€ç–‘å…¶å†…éƒ¨å®ç°æœ‰ä¸€äº›å¼‚æ­¥æ“ä½œï¼Œå¯¼è‡´çš„æ²¡æœ‰ç«‹å³æ›´æ–°<code>localStorage</code></p><div class="language-ts" data-ext="ts" data-title="ts"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// æ›´æ¢\`editor.value\`ä¸º</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">localStorage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">setItem</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;WALINE_COMMENT_BOX_EDITOR&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// æˆ–</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">await</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> nextTick</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span></code></pre></div><h3 id="_3-1-è‡³æ­¤é—®é¢˜è§£å†³" tabindex="-1"><a class="header-anchor" href="#_3-1-è‡³æ­¤é—®é¢˜è§£å†³"><span>3.1. è‡³æ­¤é—®é¢˜è§£å†³</span></a></h3><div class="hint-container info"><p class="hint-container-title">ç›¸å…³ä¿¡æ¯</p><p><strong>nextTick()</strong></p><p>ç­‰å¾…ä¸‹ä¸€æ¬¡ DOM æ›´æ–°åˆ·æ–°çš„å·¥å…·æ–¹æ³•ã€‚</p><ul><li>ç±»å‹</li></ul><div class="language-ts" data-ext="ts" data-title="ts"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">function</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> nextTick</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">callback</span><span style="color:#C678DD;--shiki-dark:#C678DD;">?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: () </span><span style="color:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> void</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">): </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Promise</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">void</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><ul><li>è¯¦ç»†ä¿¡æ¯</li></ul><p>å½“ä½ åœ¨ Vue ä¸­æ›´æ”¹å“åº”å¼çŠ¶æ€æ—¶ï¼Œæœ€ç»ˆçš„ DOM æ›´æ–°å¹¶ä¸æ˜¯åŒæ­¥ç”Ÿæ•ˆçš„ï¼Œè€Œæ˜¯ç”± Vue å°†å®ƒä»¬ç¼“å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªâ€œtickâ€æ‰ä¸€èµ·æ‰§è¡Œã€‚è¿™æ ·æ˜¯ä¸ºäº†ç¡®ä¿æ¯ä¸ªç»„ä»¶æ— è®ºå‘ç”Ÿå¤šå°‘çŠ¶æ€æ”¹å˜ï¼Œéƒ½ä»…æ‰§è¡Œä¸€æ¬¡æ›´æ–°ã€‚</p><p><strong>nextTick()</strong> å¯ä»¥åœ¨çŠ¶æ€æ”¹å˜åç«‹å³ä½¿ç”¨ï¼Œä»¥ç­‰å¾… DOM æ›´æ–°å®Œæˆã€‚ä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæˆ–è€… await è¿”å›çš„ Promiseã€‚</p></div><h2 id="_4-æ€è€ƒ" tabindex="-1"><a class="header-anchor" href="#_4-æ€è€ƒ"><span>4. æ€è€ƒ</span></a></h2><p>åœ¨<a href="https://www.vueusejs.com/core/useStorage/#usage" target="_blank" rel="noopener noreferrer">vueusejs</a>çš„æ–‡æ¡£ä¸­ï¼Œå…¶å®<code>useStorage</code>åº”è¯¥æ˜¯ä¸€ä¸ªåŒæ­¥æ“ä½œï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ª<code>useStorageAsync</code>çš„APIï¼Œæ”¯æŒå¼‚æ­¥çš„å“åº”å¼Storageï¼ŒæŒ‰ç†è¯´é‡Œè¾¹ä¸åº”è¯¥åŒ…å«å¤ªå¤šå¼‚æ­¥çš„æˆ–è€…å»¶æ—¶æ€§çš„ä»£ç ï¼Œæˆ‘ä¹Ÿæ‰¾åˆ°æºç æµ…æµ…çœ‹äº†ä¸€ä¸‹ï¼Œç›®å‰è¿˜æ²¡æ‰¾åˆ°é—®é¢˜åœ¨å“ªé‡Œï¼ŒæŒ‰ç…§æ›¿æ¢<code>localStorage.setItem(&#39;WALINE_COMMENT_BOX_EDITOR&#39;, &#39;&#39;);</code>å¯è¡Œæ¥çœ‹ï¼Œé—®é¢˜å°±åœ¨<code>useStorage</code>èº«ä¸Šæ— ç–‘ï¼Œåç»­æœ‰æ—¶é—´ï¼Œä¼šç»§ç»­æ¢ç´¢ä¸€ä¸‹ï¼Œç»™å®˜æ–¹çš„PR<a href="https://github.com/walinejs/waline/pull/2524" target="_blank" rel="noopener noreferrer">#2524</a>ä¹Ÿå·²ç»æäº†</p>`,49))])}const y=o(c,[["render",k],["__file","waline-bug.html.vue"]]),A=JSON.parse(`{"path":"/posts/Web/Vue/waline-bug.html","title":"ä¸€ä¸ª waline è¯„è®ºç³»ç»Ÿbugå¼•å‘çš„æ€è€ƒ","lang":"zh-CN","frontmatter":{"title":"ä¸€ä¸ª waline è¯„è®ºç³»ç»Ÿbugå¼•å‘çš„æ€è€ƒ","icon":"hk-waline","date":"2024-05-23T00:00:00.000Z","star":true,"headerDepth":3,"cover":"https://files.codelife.cc/wallhaven/full/6d/wallhaven-6d7xmx.jpg?x-oss-process=image/resize,limit_0,m_fill,w_1366,h_768/quality,Q_92/format,webp","category":["Vue"],"tag":["Vueå“åº”å¼"],"description":"æç¤º å‰è¨€ï¼š Waline è¯„è®ºç³»ç»Ÿè¿™ä¸ª bug æœ‰å‡ ä¸ªæœˆäº†ï¼Œç°è±¡å°±æ˜¯å›å¤å®Œå…¶ä»–äººçš„è¯„è®ºåï¼Œè¯„è®ºå†…å®¹ä¼šä¿ç•™åœ¨é¡¶éƒ¨è¾“å…¥æ¡†ä¸­ï¼Œè€Œä¸”ä¸ä¼šè‡ªåŠ¨æ¸…ç©ºã€‚å…·ä½“è§ ğŸ‘‰GitHub issuse #2173 è®¸ä¹…æœªè§ä¿®å¤ï¼Œæ­£å¥½æˆ‘æœ‰ç©ºï¼Œå°±çœ‹çœ‹è¿™ä¸ªé—®é¢˜ï¼Œæ¥ä¸‹æ¥è·Ÿæˆ‘ä¸€èµ·åˆ†æä¸€ä¸‹è¿™ä¸ªé—®é¢˜ 1. å®šä½é—®é¢˜ é—®é¢˜ç°è±¡ä¸Šè¾¹å·²ç»æè¿°è¿‡äº†ï¼Œæˆ‘ä»¬å…ˆæ¥å®šä½ä¸€ä¸‹é—®é¢˜ã€‚ 1.1. å…³é”® å…³é”®åœ¨...","head":[["meta",{"property":"og:url","content":"https://oragekk.me/posts/Web/Vue/waline-bug.html"}],["meta",{"property":"og:site_name","content":"Oragekk's Blog"}],["meta",{"property":"og:title","content":"ä¸€ä¸ª waline è¯„è®ºç³»ç»Ÿbugå¼•å‘çš„æ€è€ƒ"}],["meta",{"property":"og:description","content":"æç¤º å‰è¨€ï¼š Waline è¯„è®ºç³»ç»Ÿè¿™ä¸ª bug æœ‰å‡ ä¸ªæœˆäº†ï¼Œç°è±¡å°±æ˜¯å›å¤å®Œå…¶ä»–äººçš„è¯„è®ºåï¼Œè¯„è®ºå†…å®¹ä¼šä¿ç•™åœ¨é¡¶éƒ¨è¾“å…¥æ¡†ä¸­ï¼Œè€Œä¸”ä¸ä¼šè‡ªåŠ¨æ¸…ç©ºã€‚å…·ä½“è§ ğŸ‘‰GitHub issuse #2173 è®¸ä¹…æœªè§ä¿®å¤ï¼Œæ­£å¥½æˆ‘æœ‰ç©ºï¼Œå°±çœ‹çœ‹è¿™ä¸ªé—®é¢˜ï¼Œæ¥ä¸‹æ¥è·Ÿæˆ‘ä¸€èµ·åˆ†æä¸€ä¸‹è¿™ä¸ªé—®é¢˜ 1. å®šä½é—®é¢˜ é—®é¢˜ç°è±¡ä¸Šè¾¹å·²ç»æè¿°è¿‡äº†ï¼Œæˆ‘ä»¬å…ˆæ¥å®šä½ä¸€ä¸‹é—®é¢˜ã€‚ 1.1. å…³é”® å…³é”®åœ¨..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://files.codelife.cc/wallhaven/full/6d/wallhaven-6d7xmx.jpg?x-oss-process=image/resize,limit_0,m_fill,w_1366,h_768/quality,Q_92/format,webp"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-24T01:50:38.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://files.codelife.cc/wallhaven/full/6d/wallhaven-6d7xmx.jpg?x-oss-process=image/resize,limit_0,m_fill,w_1366,h_768/quality,Q_92/format,webp"}],["meta",{"name":"twitter:image:alt","content":"ä¸€ä¸ª waline è¯„è®ºç³»ç»Ÿbugå¼•å‘çš„æ€è€ƒ"}],["meta",{"property":"article:author","content":"Oragekk"}],["meta",{"property":"article:tag","content":"Vueå“åº”å¼"}],["meta",{"property":"article:published_time","content":"2024-05-23T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-05-24T01:50:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ä¸€ä¸ª waline è¯„è®ºç³»ç»Ÿbugå¼•å‘çš„æ€è€ƒ\\",\\"image\\":[\\"https://s3.bmp.ovh/imgs/2024/05/23/54fa93eb4563daea.png\\",\\"https://s3.bmp.ovh/imgs/2024/05/23/f4ffa6bb556812cc.png\\",\\"https://s3.bmp.ovh/imgs/2024/05/23/33bc634ac459ec19.png\\"],\\"datePublished\\":\\"2024-05-23T00:00:00.000Z\\",\\"dateModified\\":\\"2024-05-24T01:50:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Oragekk\\",\\"url\\":\\"https://orgaekk.me\\"}]}"]]},"headers":[{"level":2,"title":"1. å®šä½é—®é¢˜","slug":"_1-å®šä½é—®é¢˜","link":"#_1-å®šä½é—®é¢˜","children":[{"level":3,"title":"1.1. å…³é”®","slug":"_1-1-å…³é”®","link":"#_1-1-å…³é”®","children":[]},{"level":3,"title":"1.2. æºç ","slug":"_1-2-æºç ","link":"#_1-2-æºç ","children":[]}]},{"level":2,"title":"2. è°ƒè¯•","slug":"_2-è°ƒè¯•","link":"#_2-è°ƒè¯•","children":[{"level":3,"title":"2.1. å‡†å¤‡å·¥ä½œ","slug":"_2-1-å‡†å¤‡å·¥ä½œ","link":"#_2-1-å‡†å¤‡å·¥ä½œ","children":[]},{"level":3,"title":"2.2. å…³é”®å‡½æ•° CommentBox.vueçš„submitCommentå’Œwatch","slug":"_2-2-å…³é”®å‡½æ•°-commentbox-vueçš„submitcommentå’Œwatch","link":"#_2-2-å…³é”®å‡½æ•°-commentbox-vueçš„submitcommentå’Œwatch","children":[]},{"level":3,"title":"2.3. æ–­ç‚¹æµ‹è¯•ï¼Œæ•´ä½“æµç¨‹å¦‚ä¸‹","slug":"_2-3-æ–­ç‚¹æµ‹è¯•-æ•´ä½“æµç¨‹å¦‚ä¸‹","link":"#_2-3-æ–­ç‚¹æµ‹è¯•-æ•´ä½“æµç¨‹å¦‚ä¸‹","children":[]},{"level":3,"title":"2.4. åˆ†æ","slug":"_2-4-åˆ†æ","link":"#_2-4-åˆ†æ","children":[]}]},{"level":2,"title":"3. éªŒè¯","slug":"_3-éªŒè¯","link":"#_3-éªŒè¯","children":[{"level":3,"title":"3.1. è‡³æ­¤é—®é¢˜è§£å†³","slug":"_3-1-è‡³æ­¤é—®é¢˜è§£å†³","link":"#_3-1-è‡³æ­¤é—®é¢˜è§£å†³","children":[]}]},{"level":2,"title":"4. æ€è€ƒ","slug":"_4-æ€è€ƒ","link":"#_4-æ€è€ƒ","children":[]}],"git":{"createdTime":1716468743000,"updatedTime":1716515438000,"contributors":[{"name":"oragekk","email":"oragekk@163.com","commits":3}]},"readingTime":{"minutes":6.61,"words":1983},"filePathRelative":"posts/Web/Vue/waline-bug.md","localizedDate":"2024å¹´5æœˆ23æ—¥","excerpt":"\\n<div class=\\"hint-container tip\\">\\n<p class=\\"hint-container-title\\">æç¤º</p>\\n<p>å‰è¨€ï¼š Waline è¯„è®ºç³»ç»Ÿè¿™ä¸ª bug æœ‰å‡ ä¸ªæœˆäº†ï¼Œç°è±¡å°±æ˜¯å›å¤å®Œå…¶ä»–äººçš„è¯„è®ºåï¼Œè¯„è®ºå†…å®¹ä¼šä¿ç•™åœ¨é¡¶éƒ¨è¾“å…¥æ¡†ä¸­ï¼Œè€Œä¸”ä¸ä¼šè‡ªåŠ¨æ¸…ç©ºã€‚å…·ä½“è§ ğŸ‘‰<a href=\\"https://github.com/walinejs/waline/issues/2371\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">GitHub issuse #2173</a></p>\\n<p>è®¸ä¹…æœªè§ä¿®å¤ï¼Œæ­£å¥½æˆ‘æœ‰ç©ºï¼Œå°±çœ‹çœ‹è¿™ä¸ªé—®é¢˜ï¼Œæ¥ä¸‹æ¥è·Ÿæˆ‘ä¸€èµ·åˆ†æä¸€ä¸‹è¿™ä¸ªé—®é¢˜</p>\\n</div>","autoDesc":true}`);export{y as comp,A as data};
