import{_ as s,o as n,c as a,e}from"./app-C6CaFHmf.js";const l={},o=e(`<blockquote><p>细心的你是否也发现了 AFN 的内存泄漏的问题了呢.</p></blockquote><h3 id="解决方法" tabindex="-1"><a class="header-anchor" href="#解决方法" aria-hidden="true">#</a> 解决方法</h3><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">    + (AFHTTPSessionManager *)sharedHTTPSession{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">static</span><span style="color:#ABB2BF;"> dispatch_once_t onceToken;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">dispatch_once</span><span style="color:#ABB2BF;">(&amp;onceToken, ^{</span></span>
<span class="line"><span style="color:#ABB2BF;">        manager </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [AFHTTPSessionManager </span><span style="color:#61AFEF;">manager</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">manager</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">requestSerializer</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">timeoutInterval</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">30</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        [manager.requestSerializer  setValue:</span><span style="color:#98C379;">@&quot;XMLHttpRequest&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">forHTTPHeaderField:</span><span style="color:#98C379;">@&quot;X-Requested-With&quot;</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> manager;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    + (AFURLSessionManager *)sharedURLSession{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">static</span><span style="color:#ABB2BF;"> dispatch_once_t onceToken2;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">dispatch_once</span><span style="color:#ABB2BF;">(&amp;onceToken2, ^{</span></span>
<span class="line"><span style="color:#ABB2BF;">        urlsession </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [[AFURLSessionManager </span><span style="color:#61AFEF;">alloc</span><span style="color:#ABB2BF;">] </span><span style="color:#61AFEF;">initWithSessionConfiguration:</span><span style="color:#ABB2BF;">[NSURLSessionConfiguration </span><span style="color:#61AFEF;">defaultSessionConfiguration</span><span style="color:#ABB2BF;">]];</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> urlsession;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>将有问题的语句全部替换成单例后，再用 instruments 检查，再也没有出现泄漏的红叉了。O(∩_∩)O 哈哈~</p></blockquote>`,4),p=[o];function c(r,i){return n(),a("div",null,p)}const B=s(l,[["render",c],["__file","AFNETworking-A-memory-leak.html.vue"]]);export{B as default};
